#! /bin/bash

case $1 in
  --help)
    echo "
NAME
    rh-gitleaks-gh-account - Run rh-gitleaks on all the repos for a GH account

SYNOPSIS
    rh-gitleaks-gh-account gh-namespace

    gh-namespace := { gh-account | gh-organization }

OPTIONS
    gh-account:      A person's username
    gh-organization: The name of a github organization form the URL
"
    ;;
  *)
  for repo in $(curl https://api.github.com/users/$1/repos 2> /dev/null | jq -r 'map(.html_url)[]'); do
    echo "Scanning $repo" >&2
    rh-gitleaks -q --repo-url=$repo 2> /dev/null | jq
  done
  ;;
esac
