#! /usr/bin/env bash
set -eou pipefail

export project_dir="$(cd ../../ && pwd)"
export test_repos="$(mktemp -d)"

# By using this repo we confirm the existing history isn't an issue
git clone https://github.com/leaktk/fake-leaks.git "${test_repos}/repo-0"

cd "${test_repos}/repo-0"
git config --global user.email "integration-test@example.com"
git config --global user.name "Integration Test"

echo -n "Installing tools..."
cd "${project_dir}" && make install &> /dev/null
cd "${test_repos}"
echo "done!"

# Configure it with the default settings
"${HOOK}" configure --configure-git-template --force
"${HOOK}" --hook-type commit-msg configure --configure-git-template --force

# Enable it for all existing projects under the home directory
"${HOOK}" install --force --path "${test_repos}"
"${HOOK}" --hook-type commit-msg install --force --path "${test_repos}"


function pass {
  echo "${1} (PASS)"
}

function fail {
  echo "${1} (FAIL)"
  exit 1
}
