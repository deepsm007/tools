#! /usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
GITREF="$(git rev-parse --abbrev-ref HEAD)"

function run-test {
  echo "======================================================================="
  echo "Running in RHEL"
  "${SCRIPT_DIR}/run-in-rhel" ${@}
  echo "======================================================================="

  echo "======================================================================="
  echo "Running in Fedora"
  "${SCRIPT_DIR}/run-in-fedora" ${@}
  echo "======================================================================="

  echo "======================================================================="
  echo "Running on host (WARNING this resets host config)"
  "${SCRIPT_DIR}/"${@}
  echo "======================================================================="
}

run-test test-hook rh-pre-commit "${GITREF}"
run-test test-hook rh-multi-pre-commit "${GITREF}"
