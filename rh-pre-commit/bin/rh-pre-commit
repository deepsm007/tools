#! /bin/bash
set -euo pipefail

#
# Checks
#

function check-secrets {
  if [[ -f .gitleaks.toml ]]
  then
    additional_config="--additional-config=.gitleaks.toml"
  else
    additional_config=""
  fi

  rh-gitleaks "${additional_config}" --verbose --no-git --redact --format=json --path=.
}

#
# Run Checks
#
# Make sure that each of these are configurable

if [[ "$(git config --bool hooks.checkSecrets)" != "false" ]]
then
  check-secrets
else
  echo "Skipping secrets check because hooks.checkSecrets is set to false"
fi
