import sys
import shlex

import rh_gitleaks.config

# If making any significant changes to this template, change the ID so
# that it is easier to locate older versions
RH_MULTI_PRE_COMMIT_HOOK = {
    "pre-commit": f"""#!/bin/bash
# File generated by rh-multi-pre-commit
# ID: ed00ee75-4516-44ef-8b25-28ca3d18d91a

INSTALL_PYTHON={shlex.quote(sys.executable)}

if [ -x "$INSTALL_PYTHON" ]; then
    exec "$INSTALL_PYTHON" -m rh_pre_commit.multi
elif command -v rh-multi-pre-commit > /dev/null; then
    exec rh-multi-pre-commit
else
    echo '`rh-multi-pre-commit` not found.' 1>&2
    echo 'For more information: https://gitlab.corp.redhat.com/infosec-public/developer-workbench/tools/-/blob/main/rh-pre-commit/README.md' 1>&2
    exit 1
fi
""",
    "commit-msg": f"""#!/bin/bash
# File generated by rh-multi-pre-commit
# ID: c1de033c-4171-11ee-be56-0242ac120002

INSTALL_PYTHON={shlex.quote(sys.executable)}

if [ -x "$INSTALL_PYTHON" ]; then
    exec "$INSTALL_PYTHON" -m rh_pre_commit.multi
elif command -v rh-multi-pre-commit > /dev/null; then
    exec rh-multi-pre-commit
else
    echo '`rh-multi-pre-commit` not found.' 1>&2
    echo 'For more information: https://gitlab.corp.redhat.com/infosec-public/developer-workbench/tools/-/blob/main/rh-pre-commit/README.md' 1>&2
    exit 1
fi
""",
}

RH_PRE_COMMIT_HOOK = {
    "pre-commit": f"""#!/bin/bash
# File generated by rh-pre-commit
# ID: 378a113b-5011-4170-9dd7-9ee9e37366b3

INSTALL_PYTHON={shlex.quote(sys.executable)}

if [ -x "$INSTALL_PYTHON" ]; then
    exec "$INSTALL_PYTHON" -m rh_pre_commit
elif command -v rh-pre-commit > /dev/null; then
    exec rh-pre-commit
else
    echo '`rh-pre-commit` not found.' 1>&2
    echo 'For more information: https://gitlab.corp.redhat.com/infosec-public/developer-workbench/tools/-/blob/main/rh-pre-commit/README.md' 1>&2
    exit 1
fi
""",
    "commit-msg": f"""#!/bin/bash
# File generated by rh-pre-commit
# ID: d1028a36-4171-11ee-be56-0242ac120002

INSTALL_PYTHON={shlex.quote(sys.executable)}

if [ -x "$INSTALL_PYTHON" ]; then
    exec "$INSTALL_PYTHON" -m rh_pre_commit --hook-type commit-msg --file $1
elif command -v rh-pre-commit > /dev/null; then
    exec rh-pre-commit --hook-type commit-msg --file $1
else
    echo '`rh-pre-commit` not found.' 1>&2
    echo 'For more information: https://gitlab.corp.redhat.com/infosec-public/developer-workbench/tools/-/blob/main/rh-pre-commit/README.md' 1>&2
    exit 1
fi
""",
}

RH_MULTI_CONIFG = f"""\
repos:
  - repo: local
    hooks:
      - id: rh-pre-commit
        name: Run standard RH pre-commit checks
        language: system
        entry: {shlex.quote(sys.executable)} -m rh_pre_commit
        pass_filenames: false
"""

LEAK_DETECTED = f"""\
ERROR: rh-gitleaks has detected sensitive information in your changes and will
not allow the commit to proceed.

If it the file contains sensitive information, please remove it and try
your commit again.

If the detection was a false positive, the documentation[1] contains a section
for handling false positives.

[1] {rh_gitleaks.config.PATTERN_SERVER_DOCS_URL}
"""
